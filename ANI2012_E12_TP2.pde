/* ANI-2021 - Programmation en animation
 * Hiver 2022
 * Travail pratique 2
 * Équipe 12 composée de :
   * Alexandre Doucet-Lagueux
   * Christophe Chalifour-Perutin
   * Julie Charbonneau
   * Maïlys Gaudin
   * Olivier Desmarais
 */
 
//Importations nécessaires au bon fonctionnement du programme.
import processing.sound.*;
import java.util.Iterator;
import processing.video.*; // Dépendance: Video 2.0 | GStreamer-based video library for Processing.
import java.util.TreeMap;

//Strcture du canevas
final int dimensionX = 1020;
final int dimensionY = 720;

//Nombre de captures d'écran réalisées pendant l'exécution du programme
int idxCapture;

//Références
int centreX, centreY;
boolean pressed;

//Polices de caractère
PFont policeTitre, policeTexte, policeBouton;

//Structure du jeu
boolean debut, principal;
Bouton bCommencer;

//Environnement
PImage imgAccueil;
PImage imgBackground1, imgBackground2, imgBackground3, imgBackground4;
PImage imgPremierPlan;
Movie auroresBoreales;
SoundFile sonClic;

//Feuillage
Feuillage feuillage;
Table dataFeuilles;

//Animations
Sequencer sequencer;

//Brume
int idxCouleurBrumeRef;
ParticleSystem psBrume;
            //couleur :  jaune    rose     bleu     vert
color[] couleursBrume = {#eccd16, #FF3869, #24B4AB, #C7EA46};

//Fées
int nbFees = 5;
Fee[] tabFees;
PGraphics feeRefFond;
PImage[] feeRefBleu, feeRefJaune, feeRefRose;
AnimationClip clipFee;
SoundFile sonFee;

//Animaux
PImage imgRenard, imgLapin, imgSanglier, imgOrignal;
SoundFile sonRenard, sonLapin, sonSanglier, sonOrignal; 
//Animal animal, repere;
Animaux gestionAnimaux;
AnimationClip clipAnimaux[] = new AnimationClip[4];

//Baguette
PImage imgBaguette;
ParticleSystem psEtoile;
int psEtoileCompte = 500;
SoundFile sonEtoile1;
Vector3D pointeBaguette;

//Musique
Musique musique;

//Test
boolean isGoingLeft, isGoingRight, isGoingDown, isGoingUp;
boolean isRotatingLeft, isRotatingRight;

void settings() {
  size( dimensionX, dimensionY);
}

void setup() {
  
  frameRate(30);
  randomSeed(millis());
  
  //Références
  idxCapture = 1;
  pressed = false;
  centreX = width / 2;
  centreY = height / 2;
  
  //Structure du jeu
  debut = true;
  principal = false;
  //fin = false;
  sonClic = new SoundFile(this, "audios/sonClic.wav");
  
  //Polices
  policeTitre  = loadFont("polices/Luminari-Regular-48.vlw");
  policeTexte  = loadFont("polices/TimesNewRomanPSMT-48.vlw");
  policeBouton = loadFont("polices/AvenirLTStd-Heavy-48.vlw");
  
  //Début du jeu
  bCommencer = new Bouton (centreX, 525, 285, 85, "COMMENCER", 22);
  
  //Environnement
  imgAccueil = loadImage("images/ACCEUIL.png");
  imgBackground1 = loadImage("images/LAYER01_BCKGRND.png");
  imgBackground2 = loadImage("images/LAYER02_BCKGRND.png");
  imgBackground3 = loadImage("images/LAYER03_BCKGRND.png");
  imgBackground4 = loadImage("images/LAYER04_BCKGRND.png");
  imgAccueil.filter(POSTERIZE, 200);
  imgAccueil.filter(BLUR, 2);
  
  imgPremierPlan = loadImage("images/FORET_M1.png");
  auroresBoreales = new Movie(this, "video/videoAurore_2.mp4");
  auroresBoreales.loop();
  idxCouleurBrumeRef = int(random(couleursBrume.length));
  psBrume = new ParticleSystem(50, ParticleSystem.PARTICLE_TYPE_BRUME);

  //Feuillage
  dataFeuilles = loadTable("csv/donneesFeuilles.csv", "header");
  feuillage = new Feuillage();

  //Fée
  //Affichage
  genererFeeRefFond();
  feeRefBleu = remplirTabImgRef("bleu");
  feeRefJaune = remplirTabImgRef("jaune");
  feeRefRose = remplirTabImgRef("rose");
  //Collection
  tabFees = new Fee[nbFees];
  for (int idx = 0 ; idx < nbFees ; idx++)
    tabFees[idx] = new Fee();
  sonFee = new SoundFile (this, "audios/sonFee.wav");
   
  //Animaux
  imgRenard   = loadImage("images/animaux/RENARD_S.png");
  imgLapin    = loadImage("images/animaux/LAPIN_S.png");
  imgSanglier = loadImage("images/animaux/SANGLIER_S.png");
  imgOrignal  = loadImage("images/animaux/ORIGNAL_S.png");
  sonRenard = new SoundFile(this, "audios/animaux/sonRenard.wav");
  sonLapin = new SoundFile(this, "audios/animaux/sonLapin.wav");
  sonSanglier = new SoundFile(this, "audios/animaux/sonSanglier.mp3");
  sonOrignal = new SoundFile(this, "audios/animaux/sonOrignal.wav");
  gestionAnimaux = new Animaux();
  
  //Test
  //animal = new AnimalOrignal(0);
  //repere = new Repere();
  
  //Animation
  String[] tabCourbeFee = {"rotation"};
  clipFee = new AnimationClip(tabCourbeFee);
  String[] tabCourbeAnimaux = {"positionX", "positionY", "rotation"};
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE] = new AnimationClip(tabCourbeAnimaux);
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE] = new AnimationClip(tabCourbeAnimaux);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE] = new AnimationClip(tabCourbeAnimaux);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE] = new AnimationClip(tabCourbeAnimaux);

  //Baguette
  imgBaguette = loadImage("images/BAGUETTE01.png");
  psEtoile = new ParticleSystem(psEtoileCompte, ParticleSystem.PARTICLE_TYPE_ETOILE);
  sonEtoile1 = new SoundFile(this, "audios/sonEtoileMono.mp3");
  pointeBaguette = new Vector3D();
    
  //Musique
  musique = new Musique();
  
  musique.enveloppeMusique = new Env(this);
  
  SinOsc oscillateur = new SinOsc(this);
  oscillateur.amp(0.2f);
  musique.oscillateur = oscillateur;
  
  //Animations
  sequencer = new Sequencer();
  sequencer.clipFee = clipFee;
  sequencer.clipAnimaux = clipAnimaux;
  ajouterPosesCles();
  
  //Test
  isGoingLeft = isGoingRight = isGoingDown = isGoingUp = false;
  isRotatingLeft = isRotatingRight = false;
}

void draw() {
  //Écran d'accueil
  if (debut) {
    afficherAccueil();
  }
  
  //Déroulement du jeu
  if(principal) {    
    //Écran principal
    afficherPrincipal();
    musique.update();

  }
  
  //Afficher la baguette
  afficherBaguette();
  
  //Test
  /*if (isGoingLeft)
    repere.position.x--;
  if (isGoingRight)
    repere.position.x++;
  if (isGoingDown)
    repere.position.y++;
  if (isGoingUp)
    repere.position.y--;
    
  if (isRotatingRight)
    repere.rotation += 0.01;
  if (isRotatingLeft)
    repere.rotation -= 0.01;*/
    

  //repere.render();
  //renard.render();
}

void mousePressed() {
  //À quelques endroits dans le programme, il est vérifié si la souris est pressée.
  //Cette variable est notée dans le boolean "pressed".
  pressed = true;
  
  if (principal){
    //Vérifier si une ou des fées sont attrapées
    for (Fee fee : tabFees) {
      if(fee.verifierSuperposition() && pressed) {
          fee.attrapee = true;
          fee.timeLast = millis();
      }
    }
    
    for (Animal animal : gestionAnimaux.animauxShow) {
      if (animal.verifierSuperposition())
        animal.son.play();
    }
  }
}

void mouseReleased() {
  //Pendant le jeu :
  if (principal){
    //Relâcher toutes les fées
    for (Fee fee : tabFees)
      fee.attrapee = false;
  }
  
  //Pendant le début :
  //Il est vérifié si le relâchement de la souris démontre le désir de cliquer
  //sur le bouton commencer.
  if (debut) {
    if (bCommencer.verifierSuperposition(pointeBaguette.x, pointeBaguette.y)) {
      clicBouton();
    }
  }

  //La souris n'est plus pressée
  pressed = false;
}

void keyPressed() {
  
  //Test
  if (key == 'a')
    isGoingLeft = true;
  if (key == 'd')
    isGoingRight = true;
  if (key == 'w')
    isGoingUp = true;
  if (key == 's')
    isGoingDown = true;
  if (keyCode == RIGHT)
    isRotatingRight = true;
  if (keyCode == LEFT)
    isRotatingLeft = true;
}

void keyReleased() {
  //Raccourci pour cliquer sur un bouton (ENTER)
  if (keyCode == ENTER) {
    clicBouton();
  }
  
  //Touche pour activer/inactiver la musique ('m')
  if (key == 'm') {
    musique.musiqueOn = !musique.musiqueOn;
    musique.timeNow = musique.timeLast = millis();
  }
  
  //Touche pour réaliser une capture d'écran ('p')
  if (key == 'p') {
    save("captures/capture" + nf(idxCapture, 2) + ".png");
    idxCapture++;
  }
  
  //La flèche vers le haut permet d'augmenter la profondeur des feuilles dans le paysage
  if (keyCode == UP)
  {
    feuillage.depthCurrent = ++feuillage.depthCurrent < feuillage.depthMax ? feuillage.depthCurrent : feuillage.depthMax;
    feuillage.generate();
  }
  
  //La flèche vers le bas permet de diminuer la profondeur des feuilles dans le paysage
  if (keyCode == DOWN)
  {
    feuillage.depthCurrent = --feuillage.depthCurrent > 0 ? feuillage.depthCurrent : 0;
    feuillage.generate();
  }
  
  
  //Test
  if (key == 'a')
    isGoingLeft = false;
  if (key == 'd')
    isGoingRight = false;
  if (key == 'w')
    isGoingUp = false;
  if (key == 's')
    isGoingDown = false;
  if (keyCode == RIGHT)
    isRotatingRight = false;
  if (keyCode == LEFT)
    isRotatingLeft = false;

    
  //Test
  /*if (key == ' ')
    println("position : (" + repere.position.x + ", " + repere.position.y + "), rotation : " + repere.rotation);*/
    
  if (key == 'z') {
    
    if (gestionAnimaux.animauxDispos.size() >0)
      gestionAnimaux.apparitionAnimal();
  }
}

void ajouterPosesCles() {
  //Fée
  clipFee.curveCollection.get("rotation").addKeyframe( 0.0f, 0.0f);
  clipFee.curveCollection.get("rotation").addKeyframe( 0.5f, radians(-80.0f));
  clipFee.curveCollection.get("rotation").addKeyframe( 1.0f, 0.0f);
  
  //Animaux
  //ENTREE_DEVANT_GAUCHE
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("positionX").addKeyframe( 0.0f, -3.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("positionY").addKeyframe( 0.0f, 239.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("rotation").addKeyframe( 0.0f, 0.22f);
  
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("positionX").addKeyframe( 20.0f, 839.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("positionY").addKeyframe( 20.0f, 415.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("rotation").addKeyframe(  20.0f, 0.19f);
  
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("positionX").addKeyframe( 22.0f, 861.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("positionY").addKeyframe( 22.0f, 427.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("rotation").addKeyframe(  22.0f, 0.59f);
  
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("positionX").addKeyframe( 30.0f, 1013.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("positionY").addKeyframe( 30.0f, 537.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_GAUCHE].curveCollection.get("rotation").addKeyframe(  30.0f, 0.62f);
  
  //ENTREE_DEVANT_DROITE
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("positionX").addKeyframe( 0.0f, 1013.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("positionY").addKeyframe( 0.0f, 537.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("rotation").addKeyframe(  0.0f, 0.62f);
  
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("positionX").addKeyframe( 8.0f, 861.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("positionY").addKeyframe( 8.0f, 427.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("rotation").addKeyframe(  8.0f, 0.59f);
  
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("positionX").addKeyframe( 10.0f, 839.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("positionY").addKeyframe( 10.0f, 415.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("rotation").addKeyframe(  10.0f, 0.19f);
  
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("positionX").addKeyframe( 30.0f, -3.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("positionY").addKeyframe( 30.0f, 239.0f);
  clipAnimaux[Animal.ENTREE_DEVANT_DROITE].curveCollection.get("rotation").addKeyframe(  30.0f, 0.22f);
  
  //ENTREE_ARRIERE_GAUCHE
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("positionX").addKeyframe( 0.0f, 293.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("positionY").addKeyframe( 0.0f, 474.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("rotation").addKeyframe(  0.0f, -0.77f);
  
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("positionX").addKeyframe( 4.0f, 403.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("positionY").addKeyframe( 4.0f, 370.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("rotation").addKeyframe(  4.0f, -0.78f);
  
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("positionX").addKeyframe( 6.0f, 434.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("positionY").addKeyframe( 6.0f, 347.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("rotation").addKeyframe(  6.0f, -0.13f);
  
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("positionX").addKeyframe( 28.0f, 1023.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("positionY").addKeyframe( 28.0f, 258.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("rotation").addKeyframe(  28.0f, -0.15f);
  
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("positionX").addKeyframe( 30.0f, 1102.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("positionY").addKeyframe( 30.0f, 241.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_GAUCHE].curveCollection.get("rotation").addKeyframe(  30.0f, -0.15f);
  
  //ENTREE_ARRIERE_DROITE
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("positionX").addKeyframe( 0.0f, 1102.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("positionY").addKeyframe( 0.0f, 241.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("rotation").addKeyframe(  0.0f, -0.15f);
  
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("positionX").addKeyframe( 2.0f, 1023.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("positionY").addKeyframe( 2.0f, 258.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("rotation").addKeyframe(  2.0f, -0.15f);
  
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("positionX").addKeyframe( 24.0f, 434.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("positionY").addKeyframe( 24.0f, 347.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("rotation").addKeyframe(  24.0f, -0.13f);
  
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("positionX").addKeyframe( 26.0f, 403.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("positionY").addKeyframe( 26.0f, 370.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("rotation").addKeyframe(  26.0f, -0.78f);
  
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("positionX").addKeyframe( 30.0f, 293.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("positionY").addKeyframe( 30.0f, 474.0f);
  clipAnimaux[Animal.ENTREE_ARRIERE_DROITE].curveCollection.get("rotation").addKeyframe(  30.0f, -0.77f);
} 



void afficherAccueil() {                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  //Background de l'écran d'accueil
  imageMode(CORNER);
  image(imgAccueil, 0, 0);

  //Affichage du titre
  textAlign(CENTER, CENTER);
  fill(255,255,255);
  textFont(policeTitre, 120);
  text("Fairydust", centreX, 200);
  
  //Affichage des instructions
  fill(255);
  textFont(policeTexte, 18);
  String[] lignesTexte = new String[4];
  lignesTexte[0] = "Vous devez, à l'aide d'une baguette magique, attraper les différentes fées ";
  lignesTexte[1] = "qui volent devant vous. Vous pouvez également interagir avec les animaux ";
  lignesTexte[2] = "et entendre leurs cris. Cliquez partout et découvrez les plus grands secrets ";
  lignesTexte[3] = "qui se cachent au cœur de la forêt.";
  //Emplacement de chacune des lignes
  float posY = 340;  
  int hauteurLigne = 20;
  //Affichage de chacune des lignes
  for (int ligne = 0 ; ligne < lignesTexte.length ; ligne++) {
    text(lignesTexte[ligne], centreX, posY);
    posY += hauteurLigne;
  }
  
  //Afficage du bouton pour commencer
  bCommencer.render();
}
  

void afficherPrincipal() {
  
 
  //Vidéo en arrière-plan (-5)
  auroresBoreales.play();
  imageMode(CORNER);
  image(auroresBoreales, 0, -250);
  
  //Arrière-plan-4
  tint(255, 150);
  image(imgBackground4, 0, 0);
  tint(255, 255);
 
  //Animaux
  gestionAnimaux.update();
  
  
  //Arrière-plan-3
  imageMode(CORNER);
  image(imgBackground3, 0, 0);
  gestionAnimaux.render(false);
  //filter(BLUR);
  
  //Arrière-plan-2
  imageMode(CORNER);
  //imgBackground2.filter(BLUR);
  image(imgBackground2, 0, 0);
  gestionAnimaux.render(true);
  //filter(BLUR);

  
  //Affichage de la brume
  psBrume.update(true);
  
  //Arrièreplan-1
  imageMode(CORNER);
  image(imgBackground1, 0, 0);
  
  //Mise à jour et affichage des fées
  for (Fee fee : tabFees) {
    fee.update();
    fee.render();
  }
  
  //Afficher le feuillage dans les arbres
  feuillage.render();
  
  //Affficher le premier-plan
  imageMode(CORNER);
  image(imgPremierPlan, 0, 0);
}

//Lecture successive des images de la vidéo
void movieEvent(Movie movie)
{
  if (movie.available())
    movie.read();
}

//Fonction appelée lorsque le bouton "commencer" est appuyé
void clicBouton() {
  //Initialisation de la partie
  //initialisation();
  
  //Transition du début/de la fin du jeu vers le jeu
  principal = true;
  debut = false;
  
  //Son du bouton
  sonClic.play();
  
  musique.timeNow = musique.timeLast = millis();
}

//Fonction permettant d'afficher la baguette utilisée par le joueur pour interagir avec le programme.
void afficherBaguette() {
  
  //Identifier l'emplacement de la pointe de la baguette
  pointeBaguette.set(mouseX - imgBaguette.width / 2 + 40.0f, mouseY - imgBaguette.height / 2 + 35.0f, 0.0f);
  
  //Update et affichage d'un système de particules en forme d'étoile à la pointe de la baguette. 
  //De nouvelles particules ne sont créées que lorsque la souris est enfoncée.
  psEtoile.update(pressed);
  
  //Afficher la baguette à l'endroit approprié
  imageMode(CORNER);
  image(imgBaguette, mouseX - imgBaguette.width / 2 + 22.5f, mouseY - imgBaguette.height / 2 + 20.0f, imgBaguette.width / 2, imgBaguette.height / 2);
  
}

//Fonction qui remplit et retourne un tableau d'images de références pour l'illustration des fées
PImage[] remplirTabImgRef( String couleurType) {
  
  //Création du tableau d'images de référence
  PImage[] tabImgRef = new PImage[3];
  
  //Chargement et ajout des images dans le tableau
  for (int idx = 0 ; idx < 3 ; idx++) {
    tabImgRef[idx] = loadImage("images/fee/" + couleurType + "/" + idx + ".png");
  }  
  
  //Retour du tableau
  return tabImgRef;
}


//Fonction générant le système chaotique qui sert d'arrière-plan aux fées
void genererFeeRefFond() {
  
  //Source : https://nathanselikoff.com/training/tutorial-strange-attractors-in-c-and-opengl

  float x = 0.1, y = 0.1,    // starting point
        a = -0.966918,       // coefficients for "The King's Dream"
        b = 2.879879,
        c = 0.765145,
        d = 0.744728;

  int iterations = 2500000;    // number of times to iterate through
                               // the functions and draw a point
  
  //Configurations
  feeRefFond = createGraphics(400, 400);
  feeRefFond.smooth(8);
  feeRefFond.beginDraw();
  feeRefFond.fill(255);
  feeRefFond.stroke(255, 10);
  feeRefFond.strokeWeight(0.005);
  feeRefFond.scale(100, 100);
  feeRefFond.translate(2, 2);
  
  // Dessiner tous les points
  for (int i = 0; i < iterations; i++) {
 
    // Computer la position du prochain point
    float xnew = sin(y*b) + c*sin(x*b);
    float ynew = sin(x*a) + d*sin(y*a);
 
    // Enregistrer la position
    x = xnew;
    y = ynew;
 
    //Dessin du point
    feeRefFond.point(x, y);
  }
  
  //Fin du dessin
  feeRefFond.endDraw();
}
