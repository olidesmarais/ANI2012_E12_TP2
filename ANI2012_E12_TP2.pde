/* ANI-2021 - Programmation en animation
 * Hiver 2022
 * Travail pratique 2
 * Équipe 12 composée de :
   * Alexandre Doucet-Lagueux
   * Christophe Chalifour-Perutin
   * Julie Charbonneau
   * Maïlys Gaudin
   * Olivier Desmarais
 */
 
//Importations nécessaires au bon fonctionnement du programme.
import processing.sound.*;
import java.util.Iterator;
import processing.video.*; // Dépendance: Video 2.0 | GStreamer-based video library for Processing.
import java.util.TreeMap;

//Strcture du canevas
final int dimensionX = 1020;
final int dimensionY = 720;

//Nombre de captures d'écran réalisées pendant l'exécution du programme
int idxCapture;

//Références
int centreX, centreY;
boolean pressed;

//Polices de caractère
PFont policeTitre, policeTexte, policeBouton;

//Structure du jeu
boolean debut, principal;
Bouton bCommencer;

//Environnement
PImage imgAccueil;
PImage imgBackground1, imgBackground2, imgBackground3, imgBackground4;
PImage imgPremierPlan;
Movie auroresBoreales;
SoundFile sonClic;

//Feuillage
Feuillage feuillage;
Table dataFeuilles;

//Animations
Sequencer sequencer;

//Brume
int idxCouleurBrumeRef;
ParticleSystem psBrume;
            //couleur :  jaune    rose     bleu     vert
color[] couleursBrume = {#eccd16, #FF3869, #24B4AB, #C7EA46};

//Fées
int nbFees = 5;
Fee[] tabFees;
PGraphics feeRefFond;
PImage[] feeRefBleu, feeRefJaune, feeRefRose;
AnimationClip clipFee;
SoundFile sonFee;

//Animaux
PImage imgRenard;
Animal renard;

//Baguette
PImage imgBaguette;
ParticleSystem psEtoile;
int psEtoileCompte = 500;
SoundFile sonEtoile1;
Vector3D pointeBaguette;

//Gestion du temps
float timeNow, timeLast, timeElapsed;

//Musique
SinOsc musique;
Env enveloppeMusique;
final int[] notesMusique = {440, 494, 554, 494, 440, 494, 554, 494,
                            415, 440, 494, 440, 415, 440, 494, 440,
                            370, 415, 440, 415, 370, 415, 440, 415,
                            415, 440, 494, 440, 415, 440, 494, 440}; 
int idxNote;
float delaiMusique;
float frequenceMusique;
float delaiNote;
final float longueurNote = 0.1f;
boolean musiqueOn;



//Test
boolean isGoingLeft, isGoingRight, isGoingDown, isGoingUp;
boolean isRotatingLeft, isRotatingRight;

void settings() {
  size( dimensionX, dimensionY);
}

void setup() {
  
  frameRate(30);
  
  //Références
  idxCapture = 1;
  pressed = false;
  centreX = width / 2;
  centreY = height / 2;
  
  //Structure du jeu
  debut = true;
  principal = false;
  //fin = false;
  sonClic = new SoundFile(this, "audios/sonClic.wav");
  
  //Polices
  policeTitre  = loadFont("polices/Luminari-Regular-48.vlw");
  policeTexte  = loadFont("polices/TimesNewRomanPSMT-48.vlw");
  policeBouton = loadFont("polices/AvenirLTStd-Heavy-48.vlw");
  
  //Début du jeu
  bCommencer = new Bouton (centreX, 525, 285, 85, "COMMENCER", 22);
  
  //Environnement
  imgAccueil = loadImage("images/ACCEUIL.png");
  imgBackground1 = loadImage("images/LAYER01_BCKGRND.png");
  imgBackground2 = loadImage("images/LAYER02_BCKGRND.png");
  imgBackground3 = loadImage("images/LAYER03_BCKGRND.png");
  imgBackground4 = loadImage("images/LAYER04_BCKGRND.png");
  imgPremierPlan = loadImage("images/FORET_M1.png");
  auroresBoreales = new Movie(this, "video/videoAurore_2.mp4");
  auroresBoreales.loop();
  idxCouleurBrumeRef = int(random(couleursBrume.length));
  psBrume = new ParticleSystem(50, ParticleSystem.PARTICLE_TYPE_BRUME);

  //Feuillage
  dataFeuilles = loadTable("donneesFeuilles.csv", "header");
  feuillage = new Feuillage();

  //Fée
  //Affichage
  genererFeeRefFond();
  feeRefBleu = remplirTabImgRef("bleu");
  feeRefJaune = remplirTabImgRef("jaune");
  feeRefRose = remplirTabImgRef("rose");
  //Collection
  tabFees = new Fee[nbFees];
  for (int idx = 0 ; idx < nbFees ; idx++)
    tabFees[idx] = new Fee();
   
  //Animaux
  imgRenard = loadImage("images/animaux/RENARD_S.png");
  renard = new Renard();
  
  //Animation
  String[] tabCourbeFee = {"rotation"};
  clipFee = new AnimationClip(tabCourbeFee);
  sonFee = new SoundFile (this, "audios/sonFee.wav");

  //Baguette
  imgBaguette = loadImage("images/BAGUETTE01.png");
  psEtoile = new ParticleSystem(psEtoileCompte, ParticleSystem.PARTICLE_TYPE_ETOILE);
  sonEtoile1 = new SoundFile(this, "audios/sonEtoileMono.mp3");
  pointeBaguette = new Vector3D();
    
  //Musique
  musique = new SinOsc(this);
  enveloppeMusique = new Env(this);
  musique.amp(0.2f);
  idxNote = 0;
  musiqueOn = true;
  frequenceMusique = 0.5f;
  
  //Animations
  sequencer = new Sequencer();
  sequencer.clipFee = clipFee;
  ajouterPosesCles();
  
  //Test
  isGoingLeft = isGoingRight = isGoingDown = isGoingUp = false;
  isRotatingLeft = isRotatingRight = false;
}

void draw() {
  //Écran d'accueil
  if (debut) {
    afficherAccueil();
  }
  
  //Déroulement du jeu
  if(principal) {    
    //Écran principal
    afficherPrincipal();

    //Gestion du temps
    timeNow = millis();
    timeElapsed = (timeNow - timeLast) / 1000.0f;
    timeLast = timeNow;
      
    //Jouer la musique
    //La vitesse de la musique est directement proportionnelle avec le nombre
    //d'ennemis dans la collection d'ennemis
    //frequenceMusique = map(listeEnnemis.size(), 0, objectifDefaite, 0.2f, 0.1f);
    delaiMusique += timeElapsed;
    if (delaiMusique > frequenceMusique) {
      //Option pour inactiver le son (Touche 'm')
      if (musiqueOn)
        jouerMusique();
      delaiMusique -= frequenceMusique;
    }
  }
  
  //Afficher la baguette
  afficherBaguette();
  
  //Test
  if (isGoingLeft)
    renard.position.x--;
  if (isGoingRight)
    renard.position.x++;
  if (isGoingDown)
    renard.position.y++;
  if (isGoingUp)
    renard.position.y--;
    
  if (isRotatingRight)
    renard.rotation += 0.01;
  if (isRotatingLeft)
    renard.rotation -= 0.01;
    

  renard.render();
}

void mousePressed() {
  //À quelques endroits dans le programme, il est vérifié si la souris est pressée.
  //Cette variable est notée dans le boolean "pressed".
  pressed = true;
  
  if (principal){
    //Vérifier si une ou des fées sont attrapées
    for (Fee fee : tabFees) {
      if(fee.verifierSuperposition() && pressed) {
          fee.attrapee = true;
          fee.timeLast = millis();
      }
    }
  }
  
  
  
}

void mouseReleased() {
  //Pendant le jeu :
  if (principal){
    //Relâcher toutes les fées
    for (Fee fee : tabFees)
      fee.attrapee = false;
  }
  
  //Pendant le début :
  //Il est vérifié si le relâchement de la souris démontre le désir de cliquer
  //sur le bouton commencer.
  if (debut) {
    if (bCommencer.verifierSuperposition(pointeBaguette.x, pointeBaguette.y)) {
      clicBouton();
    }
  }

  //La souris n'est plus pressée
  pressed = false;
  
  

}

void keyPressed() {
  
  //Test
  if (key == 'a')
    isGoingLeft = true;
  if (key == 'd')
    isGoingRight = true;
  if (key == 'w')
    isGoingUp = true;
  if (key == 's')
    isGoingDown = true;
  if (keyCode == RIGHT)
    isRotatingRight = true;
  if (keyCode == LEFT)
    isRotatingLeft = true;
}

void keyReleased() {
  //Raccourci pour cliquer sur un bouton (ENTER)
  if (keyCode == ENTER) {
    clicBouton();
  }
  
  //Touche pour activer/inactiver la musique ('m')
  if (key == 'm')
    musiqueOn = !musiqueOn;
  
  //Touche pour réaliser une capture d'écran ('p')
  if (key == 'p') {
    save("captures/capture" + nf(idxCapture, 2) + ".png");
    idxCapture++;
  }
  
  //La flèche vers le haut permet d'augmenter la profondeur des feuilles dans le paysage
  if (keyCode == UP)
  {
    feuillage.depthCurrent = ++feuillage.depthCurrent < feuillage.depthMax ? feuillage.depthCurrent : feuillage.depthMax;
    feuillage.generate();
  }
  
  //La flèche vers le bas permet de diminuer la profondeur des feuilles dans le paysage
  if (keyCode == DOWN)
  {
    feuillage.depthCurrent = --feuillage.depthCurrent > 0 ? feuillage.depthCurrent : 0;
    feuillage.generate();
  }
  
  
  //Test
  if (key == 'a')
    isGoingLeft = false;
  if (key == 'd')
    isGoingRight = false;
  if (key == 'w')
    isGoingUp = false;
  if (key == 's')
    isGoingDown = false;
  if (keyCode == RIGHT)
    isRotatingRight = false;
  if (keyCode == LEFT)
    isRotatingLeft = false;
    
  if (key == ' ')
    println("position : (" + renard.position.x + ", " + renard.position.y + "), rotation : " + renard.rotation);
}

void ajouterPosesCles() {
  //Fée
  clipFee.curveCollection.get("rotation").addKeyframe( 0.0f, 0.0f);
  clipFee.curveCollection.get("rotation").addKeyframe( 0.5f, radians(-80.0f));
  clipFee.curveCollection.get("rotation").addKeyframe( 1.0f, 0.0f);
}

//Fonction appelée au début de chaque partie pour initialiser toutes les valeurs
//à leur état initial
void initialisation() {
  //Gestion du temps
  timeNow = timeLast = millis();
  timeElapsed = 0.0f;
  
  //Musique
  idxNote = 0;
  jouerMusique();  
}
 

void afficherAccueil() {                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  //Background de l'écran d'accueil
  imageMode(CORNER);
  image(imgAccueil, 0, 0);

  //Affichage du titre
  textAlign(CENTER, CENTER);
  fill(255,255,255);
  textFont(policeTitre, 120);
  text("Fairydust", centreX, 200);
  
  //Affichage des instructions
  fill(255);
  textFont(policeTexte, 18);
  String[] lignesTexte = new String[4];
  lignesTexte[0] = "Vous devez, à l'aide d'une baguette magique, attraper les différentes fées ";
  lignesTexte[1] = "qui volent devant vous. Vous pouvez également interagir avec les animaux ";
  lignesTexte[2] = "et entendre leurs cris. Cliquez partout et découvrez les plus grands secrets ";
  lignesTexte[3] = "qui se cachent au cœur de la forêt.";
  //Emplacement de chacune des lignes
  float posY = 340;  
  int hauteurLigne = 20;
  //Affichage de chacune des lignes
  for (int ligne = 0 ; ligne < lignesTexte.length ; ligne++) {
    text(lignesTexte[ligne], centreX, posY);
    posY += hauteurLigne;
  }
  
  //Afficage du bouton pour commencer
  bCommencer.render();
}
  

void afficherPrincipal() {
  //Afficher le décor
  imageMode(CORNER);
 
  //Vidéo en arrière-plan (-5)
  auroresBoreales.play();
  image(auroresBoreales, 0, -250);
  
  //Arrière-plan-4
  tint(255, 150);
  image(imgBackground4, 0, 0);
  tint(255, 255);
 
  
  //Arrière-plan-3
  image(imgBackground3, 0, 0);
   //filter(BLUR, 2);
  
  //Arrière-plan-2
  image(imgBackground2, 0, 0);
  
  //Affichage de la brume
  psBrume.update(true);
  
  //Arrièreplan-1
  //image(imgBackground1, 0, 0);
  
  //Mise à jour et affichage des fées
  for (Fee fee : tabFees) {
    fee.update();
    fee.render();
  }
  
  //Afficher le feuillage dans les arbres
  //feuillage.render();
  
  //Affficher le premier-plan
  imageMode(CORNER);
  //image(imgPremierPlan, 0, 0);
}

//Lecture successive des images de la vidéo
void movieEvent(Movie movie)
{
  if (movie.available())
    movie.read();
}

//Fonction permettant la synthétisation de la musique ambiante pendant le jeu.
void jouerMusique() {
  //Jouer la musique
  musique.freq(notesMusique[idxNote]);
  musique.play();
  enveloppeMusique.play(musique, 0.01f, 0.004f, 0.3f, 0.4f);
  
  //Index de la prochaine note
  if (idxNote < notesMusique.length - 1)
    idxNote++;
  else
    idxNote = 0;
}

//Fonction appelée lorsque le bouton "commencer" est appuyé
void clicBouton() {
  //Initialisation de la partie
  initialisation();
  
  //Transition du début/de la fin du jeu vers le jeu
  principal = true;
  debut = false;
  
  //Son du bouton
  sonClic.play();
}

//Fonction permettant d'afficher la baguette utilisée par le joueur pour interagir avec le programme.
void afficherBaguette() {
  
  //Identifier l'emplacement de la pointe de la baguette
  pointeBaguette.set(mouseX - imgBaguette.width / 2 + 40.0f, mouseY - imgBaguette.height / 2 + 35.0f, 0.0f);
  
  //Update et affichage d'un système de particules en forme d'étoile à la pointe de la baguette. 
  //De nouvelles particules ne sont créées que lorsque la souris est enfoncée.
  psEtoile.update(pressed);
  
  //Afficher la baguette à l'endroit approprié
  imageMode(CORNER);
  image(imgBaguette, mouseX - imgBaguette.width / 2 + 22.5f, mouseY - imgBaguette.height / 2 + 20.0f, imgBaguette.width / 2, imgBaguette.height / 2);
  
}

//Fonction qui remplit et retourne un tableau d'images de références pour l'illustration des fées
PImage[] remplirTabImgRef( String couleurType) {
  
  //Création du tableau d'images de référence
  PImage[] tabImgRef = new PImage[3];
  
  //Chargement et ajout des images dans le tableau
  for (int idx = 0 ; idx < 3 ; idx++) {
    tabImgRef[idx] = loadImage("images/fee/" + couleurType + "/" + idx + ".png");
  }  
  
  //Retour du tableau
  return tabImgRef;
}


//Fonction générant le système chaotique qui sert d'arrière-plan aux fées
void genererFeeRefFond() {
  
  //Source : https://nathanselikoff.com/training/tutorial-strange-attractors-in-c-and-opengl

  float x = 0.1, y = 0.1,    // starting point
        a = -0.966918,       // coefficients for "The King's Dream"
        b = 2.879879,
        c = 0.765145,
        d = 0.744728;

  int iterations = 2500000;    // number of times to iterate through
                               // the functions and draw a point
  
  //Configurations
  feeRefFond = createGraphics(400, 400);
  feeRefFond.smooth(8);
  feeRefFond.beginDraw();
  feeRefFond.fill(255);
  feeRefFond.stroke(255, 10);
  feeRefFond.strokeWeight(0.005);
  feeRefFond.scale(100, 100);
  feeRefFond.translate(2, 2);
  
  // Dessiner tous les points
  for (int i = 0; i < iterations; i++) {
 
    // Computer la position du prochain point
    float xnew = sin(y*b) + c*sin(x*b);
    float ynew = sin(x*a) + d*sin(y*a);
 
    // Enregistrer la position
    x = xnew;
    y = ynew;
 
    //Dessin du point
    feeRefFond.point(x, y);
  }
  
  //Fin du dessin
  feeRefFond.endDraw();
}
